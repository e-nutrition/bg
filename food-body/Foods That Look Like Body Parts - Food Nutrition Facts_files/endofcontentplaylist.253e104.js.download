(window.webpackJsonp=window.webpackJsonp||[]).push([["modules/endofcontentplaylist"],{"8fff2404b6904b87e20c":function(e,t,i){"use strict";i.r(t),function(e,n,s,o){var l=i("7ec90be294f8945e7663"),a=i("d46c288b6d4387f2b7de"),d=i("e5f201a09441168159e8"),r=i("891a19eb7d3552f95f46"),h=i("abfbe0c0349d83b0558c"),c=i("5dc27f426de813a8f06e"),m=i("654adc4d2d3e5dbaee18");t.default=e.View.extend({el:".standard-body-content, .listicle-body-content, .recipe-body-content",endpoint:Object(m.r)("ajax/endofcontentplaylist/"),logger:new r.a("EndOfContentPlaylist"),initialize:function(){this.$el.length&&(this.setVariables(),this.setListeners())},setVariables:function(){this.overrideDefaults({mediaLoader:null}),this.window=this.options.window||window,this.mediaLoader=Object(m.d)(this.mediaLoader,h.default),this.model=new d.a,this.modelView=new a.a({model:this.model,templateSelector:"#eoc-playlist-template"}),this.isContentSponsored=!n.isEmpty(l.a.getValue("content.sponsor")),this.sectionId=this.modelView.$template.data("sectionId"),this.model.url=Object(m.f)(this.endpoint,{id:this.sectionId}),this.playerSettings={hideTitle:!0},this.titleElement=null,this.playerEvents={onLoaded:this.onPlayerLoaded.bind(this),onPlaylistItemChange:this.onPlayerPlaylistItemChange.bind(this)},this.glimmerChannel=s.channel("glimmer"),this.mediaQueryChannel=c.a,this.isInterpolated=!1},setListeners:function(){this.model.on("sync",this.onSuccess.bind(this)),this.glimmerChannel.on("player-loaded",this.onGlimmerLoaded.bind(this))},onGlimmerLoaded:function(e){e.events.on("playlistitem",this.handleGlimmerPlaylistItem.bind(this))},getPlayerApi:function(){return window.PlayerApi||window.hearstPlayer},getCustomSettings:function(){return window.hdsCustomSettingById=window.hdsCustomSettingById||{},window.hdsCustomSettingById},setTitleElement:function(e){this.titleElement=e.find(".video-title")},onPlayerLoaded:function(e){this.titleElement.show(),e.setPlayerSettings(this.playerSettings)},onPlayerPlaylistItemChange:function(e,t){this.titleElement.text(Object(m.k)("item.title",t,""))},handleGlimmerPlaylistItem:function(e){try{var t=e.target.player.playlist.getCurrentVideoSource(),i=t.title;this.isInterpolated&&t.shortTitle&&(i=t.shortTitle),this.titleElement.show(),this.titleElement.text(i)}catch(e){this.logger.log("Error grabbing title from player events.")}},setPlayerCustomSettings:function(e){var t=this.getCustomSettings();t[e]=n.extend(t[e]||{},this.playerEvents)},getPlayerEl:function(e){return e.find(".glimmerPlayer, .hearstPlayer")},isGlimmerPlayer:function(e){return e.hasClass("glimmerPlayer")},shouldGetSection:function(){return this.sectionId?this.isContentSponsored?(this.logger.log("Content is sponsored, exiting"),!1):!document.querySelector(".journey-gate")||"authorized"===Object(m.g)("mylo_status")||(this.logger.log("Content is gated and the user is not signed in, exiting"),!1):(this.logger.log("No section ID, exiting"),!1)},fetch:function(){return!!this.shouldGetSection()&&(this.logger.log("Fetching EOC Playlist",{sectionId:this.sectionId}),this.fetchModel())},fetchModel:function(){return this.model.fetch()},interpolateWatchNext:function(){var e=Object(m.k)("HRST.article.sponsor",window,[]),t=window,i=t.pianoOfferDisplayed,n=t.GDPR,s=t.GDPR_CONSENT;if(!(e.length>0||n&&!s||i)){var o=document.querySelector(".end-of-content-playlist[data-interpolate]"),l=document.querySelector(".article-body-content p:nth-of-type(3)");if(o&&l){this.isInterpolated=!0;var a=o.querySelector(".watch-next-header"),d=a.getAttribute("data-wn-label-body");l.insertAdjacentElement("afterend",o),a.textContent=d,o.classList.add("watch-next-in-body"),o.querySelector(".glimmerPlayer, .hearstPlayer").setAttribute("data-mobile-controls-on-desktop","true")}}},onSuccess:function(){var e,t=this.model.getAttributeFromData("embed_id"),i=this.getPlayerApi();if(t){e=o(this.modelView.render().el),this.$el.append(e);var n=this.getPlayerEl(e);this.setTitleElement(e),i&&(this.setPlayerCustomSettings(t),this.isGlimmerPlayer(n)||i.initPlayer(n[0])),this.logger.log("EOC Playlist added",{videoEmbedId:t}),this.interpolateWatchNext()}else this.logger.log("Embed id not found")}})}.call(this,i("292bef011bf0a540c727"),i("37047f07c1f267630157"),i("483f749fef9ba28566c7"),i("4124695a4a0df23fd56c"))}}]);
//# sourceMappingURL=endofcontentplaylist.253e104.js.map